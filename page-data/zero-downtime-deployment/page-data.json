{"componentChunkName":"component---src-templates-post-jsx","path":"/zero-downtime-deployment/","result":{"data":{"site":{"siteMetadata":{"title":"dal.log"}},"markdownRemark":{"id":"24c152c7-4e94-5b84-aaea-a5a9a8357693","excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ë‹¬ë¡íŒ€ í¬ë£¨ íŒŒë‘ì´ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ë¬´ì¤‘ë‹¨ ë°°í¬ ë„ì… ì´ìœ  ë‹¬ë¡ì˜ ê¸°ì¡´ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì´ë ‡ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ 2 â†’ 3ì˜ ê³¼ì •, êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¢…ë£Œí•˜ê³  ìƒˆë¡œ ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë©ë‹ˆë‹¤. ì €í¬ ì„œë¹„ìŠ¤ì˜ ì¤‘ë‹¨ ì‹œê°„ì„ ì¸¡ì •í•´ë³´ë‹ˆ ì•½  ì •ë„ ì¤‘ë‹¨ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì§€ê¸ˆì´ì•¼ ë‹¬ë¡ì˜ ì‚¬ìš©ìê°€ ë§ì§€ ì•Šì•„ ê·¸ ë™ì•ˆ í°â€¦","html":"<blockquote>\n<p>ì´ ê¸€ì€ ìš°í…Œì½” ë‹¬ë¡íŒ€ í¬ë£¨ <a href=\"https://github.com/summerlunaa\">íŒŒë‘</a>ì´ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>\n</blockquote>\n<h1>ë¬´ì¤‘ë‹¨ ë°°í¬ ë„ì… ì´ìœ </h1>\n<p>ë‹¬ë¡ì˜ ê¸°ì¡´ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì´ë ‡ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-z</span> <span class=\"token string\">\"<span class=\"token variable\">$CURRENT_PID</span>\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸŒˆ êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì—†ìœ¼ë¯€ë¡œ ì¢…ë£Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\"</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"ğŸŒˆ êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¢…ë£Œí–ˆìŠµë‹ˆë‹¤. (pid : <span class=\"token variable\">$CURRENT_PID</span>)\"</span>\n    <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-9</span> <span class=\"token variable\">$CURRENT_PID</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token entity\" title=\"\\n\">\\n</span>ğŸŒˆ SpringBoot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.<span class=\"token entity\" title=\"\\n\">\\n</span>\"</span>\n\n<span class=\"token assign-left variable\">JAR_NAME</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ls</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> .jar <span class=\"token operator\">|</span> <span class=\"token function\">head</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token function\">nohup</span> <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> <span class=\"token parameter variable\">-Dserver.port</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span> <span class=\"token parameter variable\">-Dspring.profiles.active</span><span class=\"token operator\">=</span><span class=\"token variable\">${SPRING_PROFILE}</span> <span class=\"token parameter variable\">-Duser.timezone</span><span class=\"token operator\">=</span>Asia/Seoul /home/ubuntu/<span class=\"token variable\">$JAR_NAME</span> <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">&amp;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í™•ì¸í•˜ê³ \n2. êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìˆë‹¤ë©´ ì¢…ë£Œí•œë‹¤.\n3. ì´í›„ jar íŒŒì¼ì„ ì‹¤í–‰í•œë‹¤.</code></pre></div>\n<p>ì—¬ê¸°ì„œ 2 â†’ 3ì˜ ê³¼ì •, êµ¬ë™ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¢…ë£Œí•˜ê³  ìƒˆë¡œ ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë©ë‹ˆë‹¤. ì €í¬ ì„œë¹„ìŠ¤ì˜ ì¤‘ë‹¨ ì‹œê°„ì„ ì¸¡ì •í•´ë³´ë‹ˆ ì•½ <code class=\"language-text\">8ì´ˆ</code> ì •ë„ ì¤‘ë‹¨ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ë¬¼ë¡  ì§€ê¸ˆì´ì•¼ ë‹¬ë¡ì˜ ì‚¬ìš©ìê°€ ë§ì§€ ì•Šì•„ ê·¸ ë™ì•ˆ í° ë¬¸ì œëŠ” ì—†ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‚¬ìš©ìê°€ ë§ì€ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œ ë§¤ ë°°í¬ë•Œë§ˆë‹¤ 8ì´ˆì”© ì„œë¹„ìŠ¤ê°€ ë©ˆì¶˜ë‹¤ë©´ ì‚¬ìš©ìë“¤ì˜ ì‹ ë¢°ê°€ ë–¨ì–´ì§€ê³  ë§¤ì¶œì—ë„ ì˜í–¥ì„ ë¯¸ì¹˜ê² ì¡°ë­ì´ë–¡? ğŸ¤”Â  ì €í¬ ë‹¬ë¡ë„ ì‚¬ìš©ìì˜ í¸ì˜ì„±ê³¼ ì„œë¹„ìŠ¤ì˜ ì•ˆì •ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ë„ì…í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>\n<h1>ë‹¬ë¡ì˜ ë°°í¬ ì „ëµ ì„ íƒ</h1>\n<p>ì´ë²ˆ ê¸€ì€ ì‹¤ì œ ë¬´ì¤‘ë‹¨ ë°°í¬ ë„ì…ê¸°ì´ê¸° ë•Œë¬¸ì— ì´ë¡ ì ì¸ ë‚´ìš©ì€ ìì„¸íˆ ë‹¤ë£¨ì§€ ì•Šê² ìŠµë‹ˆë‹¤.</p>\n<blockquote>\n<p>ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµì˜ ìì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ë‹¤ë©´? <a href=\"https://hudi.blog/zero-downtime-deployment/\">í›„ë””ì˜ ë¬´ì¤‘ë‹¨ ë°°í¬ ì•„í‚¤í…ì²˜ì™€ ë°°í¬ ì „ëµ</a>ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”.</p>\n</blockquote>\n<h2>1. ë¡¤ë§(Rolling) ë°°í¬</h2>\n<blockquote>\n<p>íŠ¸ë˜í”½ì„ ì ì§„ì ìœ¼ë¡œ êµ¬ë²„ì „ì—ì„œ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ ì˜®ê¸°ëŠ” ë°©ì‹.\nì •</p>\n</blockquote>\n<p>ì• ì´ˆì— ë‹¬ë¡ì€ EC2 í•œ ëŒ€ë§Œ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©° í˜¸í™˜ì„± ë¬¸ì œê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆì–´ ì œì™¸í–ˆìŠµë‹ˆë‹¤.</p>\n<h2>2. ì¹´ë‚˜ë¦¬(Canary) ë°°í¬</h2>\n<blockquote>\n<p>ì†Œìˆ˜ ì¸ì›ì— ëŒ€í•´ì„œë§Œ íŠ¸ë˜í”½ì„ ìƒˆë¡œìš´ ë²„ì „ì— ì˜®ê²¨ë‘” ìƒíƒœì—ì„œ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•œë‹¤. ìƒˆë¡œìš´ ë²„ì „ì— ì´ìƒì´ ì—†ë‹¤ê³  íŒë‹¨í•˜ì˜€ì„ ê²½ìš°ì— ëª¨ë“  íŠ¸ë˜í”½ì„ ì‹ ê·œ ë²„ì „ìœ¼ë¡œ ì˜®ê¸°ëŠ” ë°©ì‹. A/B í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸°ì— ì í•©í•˜ë‹¤.</p>\n</blockquote>\n<p>ë¡¤ë§ ë°°í¬ì™€ ë§ˆì°¬ê°€ì§€ë¡œ í˜¸í™˜ì„± ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤. ë˜í•œ ë‹¬ë¡ì—ì„œëŠ” íŠ¸ë˜í”½ê¹Œì§€ ì ì§„ì ìœ¼ë¡œ ì˜®ê²¨ê°€ë©° ë°°í¬í•  ì •ë„ë¡œ ì˜¤ë¥˜ ê°ì§€ì— ëŒ€í•œ í•„ìš”ì„±ì„ ëŠë¼ì§€ ëª»í•´ ì œì™¸í–ˆìŠµë‹ˆë‹¤.</p>\n<h2>3. ë¸”ë£¨ê·¸ë¦°(Blue/Green) ë°°í¬</h2>\n<blockquote>\n<p>í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ì„œë¹„ìŠ¤ë¥¼ ì¢…ë£Œí•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ ìš´ì˜ í™˜ê²½ì„ ë§Œë“  ë’¤ íŠ¸ë˜í”½ì„ í•œ ë²ˆì— ì‹ ë²„ì „ìœ¼ë¡œ ì˜®ê¸°ëŠ” ë°©ì‹.</p>\n</blockquote>\n<h3>3-1. Nê°œì˜ ì„œë²„ë¥¼ ì´ìš©í•˜ëŠ” ë°©ì‹</h3>\n<p>ê¸°ì¡´ì— Nê°œì˜ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤ë©´ ìƒˆë¡­ê²Œ Nê°œì˜ ì„œë²„ë¥¼ êµ¬ì„±í•˜ì—¬ ì‹ ë²„ì „ì„ ë°°í¬í•˜ê³  íŠ¸ë˜í”½ì„ ì˜®ê¸°ëŠ” ë°©ì‹ì…ë‹ˆë‹¤. ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ ë°°í¬ ì‹œ ì„œë²„ ìì›ì´ ë‘ ë°°ë¡œ í•„ìš”í•˜ë©° ì„œë²„ë¥¼ ì œê±°í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¶ˆí•„ìš”í•˜ê²Œ ì„œë²„ë¥¼ ë°©ì¹˜í•˜ê²Œ ë©ë‹ˆë‹¤.</p>\n<h3>3-2. <code class=\"language-text\">í¬íŠ¸ë¥¼ ë³€ê²½í•˜ëŠ” ë°©ì‹</code></h3>\n<p>í¬íŠ¸ë¥¼ ë³€ê²½í•˜ëŠ” ë°©ì‹ì˜ ì¥ì ì€ ì„œë²„ ìì›ì„ ëŠ˜ë¦¬ì§€ ì•Šì•„ë„ ë¬´ì¤‘ë‹¨ ë°°í¬ê°€ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. EC2 í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ëŠ” ë‹¬ë¡ì—ì„œëŠ” ì´ ë°©ì‹ì´ ìì›ì„ ëŠ˜ë¦¬ì§€ ì•Šìœ¼ë©° ê°„ë‹¨í•˜ê²Œ ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ì ìš©í•  ìˆ˜ ìˆëŠ” ì ì ˆí•œ ë°©ë²•ì´ë¼ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.</p>\n<p>ì´ì œ í¬íŠ¸ ë³€ê²½ ë°©ì‹ì˜ ë¸”ë£¨ê·¸ë¦° ë°°í¬ ì „ëµì„ ì–´ë–»ê²Œ ì ìš©í–ˆëŠ”ì§€ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<h1>í¬íŠ¸ ë³€ê²½ ë°©ì‹ì˜ ë¸”ë£¨ê·¸ë¦° ë°°í¬ ì „ëµ ì ìš©</h1>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/9344b830da3c9e25cda5144b40d78910/ac7a9/dallog_infra_before.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXElEQVQoz12S227TQBCGewlSyTmxnfiw3vV6fYibNMHpIW2cpCoFmpQWCbiIKoQEEkKCCyTukOAReAJe9WfW4VBxMdrZteff79+Zna+fN/j54wsOpueYLS6xP1mCMYnnRYrQZTBbHtwkwew0guj6YFxhXwUwTA+hDDFKQnh05ooMDSPAjt7wIMKDBqPw0DQDVDohTFrPpzn49AqW5aHYYxhvDhFIjutFgJv3KxxJHwPaOzYHEzHqhsROpcVxr+KgPzzBbLlGteWjaSnYlg+xeIH0zTd4lg3TCXHw6TFELHE8H+Pj93dQroAIMwyTiChjIiRBjblbdzGaLLB8dF1SVumSnhvhMBIYhgqGE+F4L8aRSKC8GIpFCG2fbHNIkYL7EXp+jKYWrHdEKcLVGP39k5JQpoeQQYrrsUKRH5V2ZpGP0csJutMMT28LXL66gFG3sdsSqFCNzZN/hPerNo6LJ1jfbNCyQshkApv18TDOsCqWCAOiNCXUaoLwLMfqdo2LZyTYtFGj+nqHHJHgX8JKk8H2s5JSX6DD6EWwugKOI2G6MU4HETLDxTgaYB4HcBsWDEug2hao/RZs/G9Zxjl1WaLTU9SEpHzLGhU0SXy2x5F/KBAoH4sixPDtHG6XlYKa0L5LuFv3kI1OUZxdlZZ1mE6MKpHrN23b29HKX5N9JSGHCfLNHI5Fo9bkJMqoKXcEa22OrpvScA7KXFvueX20u4poo5LYpcakMqUGJeCUJ5T3qLsW06HgiP52sLXA9h19uo2Vgjo05R8xvWrxBp3ptVXmCu3y2/a7/l/X/QJiaj1obv5G1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='ê¸°ì¡´ ë‹¬ë¡ì˜ ì¸í”„ë¼ êµ¬ì¡°' title='ê¸°ì¡´ ë‹¬ë¡ì˜ ì¸í”„ë¼ êµ¬ì¡°' src='/static/9344b830da3c9e25cda5144b40d78910/ca1dc/dallog_infra_before.png' srcset='/static/9344b830da3c9e25cda5144b40d78910/e7570/dallog_infra_before.png 170w,\n/static/9344b830da3c9e25cda5144b40d78910/f46e7/dallog_infra_before.png 340w,\n/static/9344b830da3c9e25cda5144b40d78910/ca1dc/dallog_infra_before.png 680w,\n/static/9344b830da3c9e25cda5144b40d78910/02d09/dallog_infra_before.png 1020w,\n/static/9344b830da3c9e25cda5144b40d78910/9d567/dallog_infra_before.png 1360w,\n/static/9344b830da3c9e25cda5144b40d78910/ac7a9/dallog_infra_before.png 1920w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>ê¸°ì¡´ ë‹¬ë¡ì˜ ì¸í”„ë¼ êµ¬ì¡°</figcaption>\n  </figure></p>\n<p>ìœ„ëŠ” ê¸°ì¡´ ë‹¬ë¡ì˜ ì¸í”„ë¼ êµ¬ì¡°ì…ë‹ˆë‹¤. ì‹¤ì œ prod ë°±ì—”ë“œ ì„œë²„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê°„ë‹¨íˆ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. ì  í‚¨ìŠ¤ì—ì„œ github actionsë¥¼ í†µí•´ mergeë¥¼ ê°ì§€\n2. ì½”ë“œë¥¼ ë¹Œë“œí•œ ë’¤ jar íŒŒì¼ì„ prod ì„œë²„ë¡œ ì „ì†¡\n3. ì  í‚¨ìŠ¤ê°€ prod ì„œë²„ì˜ jar íŒŒì¼ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰\n4. ë°°í¬ ì™„ë£Œ</code></pre></div>\n<p>ë¸”ë£¨ê·¸ë¦° ì „ëµì„ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” 3ì—ì„œ jar íŒŒì¼ì„ ì‹¤í–‰í•˜ê¸° ì „ ë°°í¬í•  í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ìœ„ì˜ 3ë²ˆì´ ì•„ë˜ì˜ ê³¼ì •ìœ¼ë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ í¬íŠ¸ ë²ˆí˜¸ í™•ì¸\n2. ìƒˆë¡­ê²Œ ë°°í¬í•  í¬íŠ¸ ë²ˆí˜¸ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰\n3. ìƒˆë¡œìš´ í¬íŠ¸ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì˜ ë–´ëŠ”ì§€ í™•ì¸(health check)\n4. nginx ì„¤ì •ì—ì„œ í¬íŠ¸ ë²ˆí˜¸ ìˆ˜ì • í›„ reload\n5. ê¸°ì¡´ í¬íŠ¸ ì¢…ë£Œ</code></pre></div>\n<p>ë‹¬ë¡ì€ ì´ ê³¼ì •ì„ ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.</p>\n<ul>\n<li>íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì„ ì–¸í˜•(Declarative)ìœ¼ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</li>\n<li>SSH Agent í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</li>\n<li>ì „ì²´ ì½”ë“œê°€ ê¶ê¸ˆí•˜ë‹¤ë©´? <a href=\"https://www.notion.so/9435a94ef13244d2bb31e4adfb339b38\">ë‹¬ë¡ì˜ backend-prod ì  í‚¨ìŠ¤ íŒŒì¼ ì „ì²´ ë³´ê¸°</a></li>\n</ul>\n<h3>1. í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ í¬íŠ¸ ë²ˆí˜¸ í™•ì¸</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">if</span> <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token string\">\"http://<span class=\"token variable\">${BACKEND_PROD_PUBLIC_IP}</span>:<span class=\"token variable\">${BLUE_PORT}</span>\"</span> <span class=\"token operator\">></span> /dev/null\n<span class=\"token keyword\">then</span>\n    <span class=\"token assign-left variable\">target_port</span><span class=\"token operator\">=</span><span class=\"token variable\">${GREEN_PORT}</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token assign-left variable\">target_port</span><span class=\"token operator\">=</span><span class=\"token variable\">${BLUE_PORT}</span>\n<span class=\"token keyword\">fi</span></code></pre></div>\n<p>BLUE<em>PORT(8080)ì— health checkë¥¼ í•©ë‹ˆë‹¤. BLUE</em>PORTê°€ ì‚´ì•„ ìˆë‹¤ë©´ <code class=\"language-text\">target_port</code>ë¥¼ GREEN<em>PORT(8081)ë¡œ, ì£½ì–´ ìˆë‹¤ë©´ BLUE</em>PORTë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p>\n<h3>2. ìƒˆë¡­ê²Œ ë°°í¬í•  í¬íŠ¸ ë²ˆí˜¸ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">scp</span> <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">StrictHostKeyChecking</span><span class=\"token operator\">=</span>no backend-0.0.1-SNAPSHOT.jar ubuntu@<span class=\"token variable\">${BACKEND_PROD_IP}</span>:/home/ubuntu\n<span class=\"token function\">ssh</span> ubuntu@<span class=\"token variable\">${BACKEND_PROD_IP}</span> <span class=\"token string\">'sh run.sh ${target_port}'</span> <span class=\"token operator\">&amp;</span></code></pre></div>\n<p><code class=\"language-text\">scp</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ jar íŒŒì¼ì„ ë°±ì—”ë“œ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì´í›„ <code class=\"language-text\">run.sh</code> ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ ë•Œ ì¸ìë¡œ <code class=\"language-text\">target_port</code> ë¥¼ ë„˜ê¹ë‹ˆë‹¤. ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#! /bin/bash</span>\n\n<span class=\"token assign-left variable\">PROJECT_NAME</span><span class=\"token operator\">=</span>backend\n<span class=\"token assign-left variable\">SPRING_PROFILE</span><span class=\"token operator\">=</span>prod\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"<span class=\"token entity\" title=\"\\n\">\\n</span>ğŸŒˆ SpringBoot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.<span class=\"token entity\" title=\"\\n\">\\n</span>\"</span>\n\n<span class=\"token assign-left variable\">JAR_NAME</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ls</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> .jar <span class=\"token operator\">|</span> <span class=\"token function\">head</span> <span class=\"token parameter variable\">-n</span> <span class=\"token number\">1</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token function\">nohup</span> <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> <span class=\"token parameter variable\">-Dserver.port</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span> <span class=\"token parameter variable\">-Dspring.profiles.active</span><span class=\"token operator\">=</span><span class=\"token variable\">${SPRING_PROFILE}</span> <span class=\"token parameter variable\">-Duser.timezone</span><span class=\"token operator\">=</span>Asia/Seoul /home/ubuntu/<span class=\"token variable\">$JAR_NAME</span> <span class=\"token operator\">></span> /dev/null <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span> <span class=\"token operator\">&amp;</span></code></pre></div>\n<p>jar íŒŒì¼ ì‹¤í–‰ ì‹œ ì‹œìŠ¤í…œ ë³€ìˆ˜ì¸ <code class=\"language-text\">server.port</code> ê°’ì„ ì„¤ì •í•´ì£¼ì–´ì„œ ì›í•˜ëŠ” í¬íŠ¸ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.</p>\n<p>ì°¾ì•„í•´ë³´ë©´ properties íŒŒì¼ì„ í¬íŠ¸ë³„ë¡œ ë‚˜ëˆ  ì‚¬ìš©í•˜ê¸°ë„ í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ í¬íŠ¸ì— ë”°ë¼ properties íŒŒì¼ì„ ë‚˜ëˆ„ë©´ ê´€ë¦¬ í¬ì¸íŠ¸ê°€ ëŠ˜ì–´ë‚˜ëŠ” ê²ƒì´ ë§ˆìŒì— ë“¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë ‡ê²Œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œ í¬íŠ¸ë¥¼ ì¸ìë¡œ ë°›ì•„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.</p>\n<h3>3. ìƒˆë¡œìš´ í¬íŠ¸ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì˜ ë–´ëŠ”ì§€ í™•ì¸(health check)</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">for</span> <span class=\"token for-or-select variable\">retry_count</span> <span class=\"token keyword\">in</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>$seq <span class=\"token number\">10</span><span class=\"token variable\">)</span></span>\n<span class=\"token keyword\">do</span>\n    <span class=\"token keyword\">if</span> <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-s</span> <span class=\"token string\">\"http://<span class=\"token variable\">${BACKEND_PROD_PUBLIC_IP}</span>:<span class=\"token variable\">${target_port}</span>\"</span> <span class=\"token operator\">></span> /dev/null\n    <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Health check success âœ… port number: <span class=\"token variable\">${target_port}</span>\"</span>\n        <span class=\"token builtin class-name\">break</span>\n    <span class=\"token keyword\">fi</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$retry_count</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">then</span>\n        <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Health check failed âŒ port number: <span class=\"token variable\">${target_port}</span>\"</span>\n        <span class=\"token builtin class-name\">exit</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">fi</span>\n\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"The server is not alive yet. Retry health check in 20 seconds... retry count: <span class=\"token variable\">${retry_count}</span>\"</span>\n    <span class=\"token function\">sleep</span> <span class=\"token number\">20</span>\n<span class=\"token keyword\">done</span></code></pre></div>\n<p>20ì´ˆ ë‹¨ìœ„ë¡œ ìµœëŒ€ 10ë²ˆ <code class=\"language-text\">target_port</code> ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì˜ ë–´ëŠ”ì§€ health checkë¥¼ ì‹¤ì‹œí•©ë‹ˆë‹¤. ì§€ê¸ˆì€ 20ì´ˆ ë‹¨ìœ„ë¡œ í™•ì¸í•˜ê³  ìˆì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì œëŒ€ë¡œ ëœ¨ì§€ ì•Šì€ ê²½ìš° 3ë¶„ 20ì´ˆë‚˜ ê¸°ë‹¤ë¦¬ê²Œ ë©ë‹ˆë‹¤. health checkì˜ í…€ì´ ë„ˆë¬´ ê¸´ ê²ƒ ê°™ê¸´ í•˜ë„¤ìš”ğŸ˜…. 10ì´ˆë‚˜ ê·¸ ì´í•˜ë¡œ ì¤„ì—¬ë„ ê´œì°®ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>\n<p>ë‹¤ì‹œ ìŠ¤í¬ë¦½íŠ¸ë¡œ ëŒì•„ì™€ì„œ health checkì— ì„±ê³µí•œë‹¤ë©´ for ë¬¸ì„ ë¹ ì ¸ ë‚˜ê°‘ë‹ˆë‹¤. ë§Œì•½ 10ë²ˆì˜ ì‹œë„ê°€ ëª¨ë‘ ì‹¤íŒ¨í•œë‹¤ë©´ exitìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.</p>\n<h3>4. nginx ì„¤ì •ì—ì„œ í¬íŠ¸ ë²ˆí˜¸ ìˆ˜ì • í›„ reload</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ssh</span> <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">StrictHostKeyChecking</span><span class=\"token operator\">=</span>no ubuntu@<span class=\"token variable\">${BACKEND_WS_IP}</span> <span class=\"token string\">\"echo 'set <span class=\"token entity\" title=\"\\\\\">\\\\</span>\\<span class=\"token variable\">$service_port</span> <span class=\"token variable\">${target_port}</span>;' | sudo tee /etc/nginx/conf.d/service-port.inc &amp;&amp; sudo service nginx reload\"</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Switch the reverse proxy direction of nginx to <span class=\"token variable\">${target_port}</span> ğŸ”„\"</span></code></pre></div>\n<p>nginxê°€ ë– ìˆëŠ” ë°±ì—”ë“œ WS ì„œë²„ì— serviceí•  í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ëŠ” íŒŒì¼ì„ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. <code class=\"language-text\">tee</code>ëŠ” ëª…ë ¹ì–´ì˜ ì¶œë ¥ ê²°ê³¼ë¥¼ íŒŒì¼ê³¼ í™”ë©´ì— ë™ì‹œì— ì¶œë ¥í•˜ëŠ” ëª…ë ¹ì–´ì…ë‹ˆë‹¤.</p>\n<p>ì¦‰, <code class=\"language-text\">echo 'set \\\\\\$service_port ${target_port};'</code> ì´ ëª…ë ¹ì˜ ê²°ê³¼ë¥¼ í™”ë©´ê³¼ <code class=\"language-text\">/etc/nginx/conf.d/service-port.inc</code> ì´ ìœ„ì¹˜ì— ì¶œë ¥í•˜ë¼ëŠ” ê²ƒì…ë‹ˆë‹¤. <code class=\"language-text\">$service_port</code> ì•ì— ì—­ìŠ¬ë˜ì‹œê°€ 3ë²ˆ ë¶™ëŠ” ì´ìœ ëŠ” <code class=\"language-text\">$</code> ë¡œ í•œ ë²ˆ, ì‘ì€ ë”°ì˜´í‘œì—ì„œ í•œ ë²ˆ, <code class=\"language-text\">ssh</code> ëª…ë ¹ì–´ì—ì„œ í•œ ë²ˆ escapeê°€ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ìš°ë¦¬ëŠ” <code class=\"language-text\">service_port</code> ì˜ ì‹¤ì œ ë³€ìˆ˜ ê°’ì„ ì“°ê³  ì‹¶ì€ ê²Œ ì•„ë‹ˆë¼ <code class=\"language-text\">$service_port</code> ì´ ë‹¨ì–´ ìì²´ë¥¼ ì“°ê³  ì‹¶ì€ ê²ƒì´ê¸° ë•Œë¬¸ì— ì—­ìŠ¬ë˜ì‹œë¥¼ 3ë²ˆ ë¶™ì—¬ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.</p>\n<p>ì´ ëª…ë ¹ì–´ë¥¼ í†µí•´ ë§Œë“¤ì–´ì§„ íŒŒì¼ì˜ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì‹¤í–‰í•  í¬íŠ¸ ë²ˆí˜¸ê°€ 8081ì¸ ê²½ìš°ì—” 8081ë¡œ ì“°ì´ê² ì£ ?</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># /etc/nginx/conf.d/service-port.inc</span>\n<span class=\"token builtin class-name\">set</span> <span class=\"token variable\">$service_port</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ì´ ì‘ì—…ì´ ëë‚˜ë©´ nginxë¥¼ reloadí•´ì„œ ë°”ë€ í¬íŠ¸ ë²ˆí˜¸ë¡œ ìš”ì²­ì´ ê°€ë„ë¡ í•©ë‹ˆë‹¤. nginxì˜ ì„¤ì • íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># /etc/nginx/conf.d/default.conf</span>\nserver <span class=\"token punctuation\">{</span>\n  listen <span class=\"token number\">443</span> ssl http2<span class=\"token punctuation\">;</span>\n  server_name api.dallog.me<span class=\"token punctuation\">;</span>\n\n  ssl_certificate /etc/letsencrypt/live/api.dallog.me/fullchain.pem<span class=\"token punctuation\">;</span>\n  ssl_certificate_key /etc/letsencrypt/live/api.dallog.me/privkey.pem<span class=\"token punctuation\">;</span>\n\n  include /etc/nginx/conf.d/service-port.inc<span class=\"token punctuation\">;</span> <span class=\"token comment\"># í¬íŠ¸ ë³€ìˆ˜ ì„ ì–¸ íŒŒì¼ include</span>\n\n  location / <span class=\"token punctuation\">{</span>\n    proxy_pass http://<span class=\"token variable\">$dallog_prod_ip</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$service_port</span><span class=\"token punctuation\">;</span> <span class=\"token comment\"># ë°”ë€ í¬íŠ¸ë¡œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •</span>\n    proxy_set_header Host <span class=\"token variable\">$http_host</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Real-IP <span class=\"token variable\">$remote_addr</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-For <span class=\"token variable\">$proxy_add_x_forwarded_for</span><span class=\"token punctuation\">;</span>\n    proxy_set_header X-Forwarded-Proto <span class=\"token variable\">$scheme</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>âš ï¸  ì—¬ê¸°ì„œ ì£¼ì˜í•  ì !! í˜¹ì‹œ í•œ ì¸ìŠ¤í„´ìŠ¤ì— nginxì™€ springì„ í•¨ê»˜ ë„ì›Œë‘ì…¨ë‚˜ìš”? </p>\n<p>í˜¹ì‹œ <code class=\"language-text\">http://localhos:$service_port;</code> ë¡œ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¥¼ ì„¤ì •í–ˆëŠ”ë° ë™ì‘ì´ ì•ˆ ë˜ë‚˜ìš”? </p>\n<p>ê·¸ë ‡ë‹¤ë©´ ì´ ë¶€ë¶„ì„ ìœ ì‹¬íˆ ë´ì£¼ì„¸ìš”.</p>\n</blockquote>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/9344b830da3c9e25cda5144b40d78910/ac7a9/dallog_infra_before.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXElEQVQoz12S227TQBCGewlSyTmxnfiw3vV6fYibNMHpIW2cpCoFmpQWCbiIKoQEEkKCCyTukOAReAJe9WfW4VBxMdrZteff79+Zna+fN/j54wsOpueYLS6xP1mCMYnnRYrQZTBbHtwkwew0guj6YFxhXwUwTA+hDDFKQnh05ooMDSPAjt7wIMKDBqPw0DQDVDohTFrPpzn49AqW5aHYYxhvDhFIjutFgJv3KxxJHwPaOzYHEzHqhsROpcVxr+KgPzzBbLlGteWjaSnYlg+xeIH0zTd4lg3TCXHw6TFELHE8H+Pj93dQroAIMwyTiChjIiRBjblbdzGaLLB8dF1SVumSnhvhMBIYhgqGE+F4L8aRSKC8GIpFCG2fbHNIkYL7EXp+jKYWrHdEKcLVGP39k5JQpoeQQYrrsUKRH5V2ZpGP0csJutMMT28LXL66gFG3sdsSqFCNzZN/hPerNo6LJ1jfbNCyQshkApv18TDOsCqWCAOiNCXUaoLwLMfqdo2LZyTYtFGj+nqHHJHgX8JKk8H2s5JSX6DD6EWwugKOI2G6MU4HETLDxTgaYB4HcBsWDEug2hao/RZs/G9Zxjl1WaLTU9SEpHzLGhU0SXy2x5F/KBAoH4sixPDtHG6XlYKa0L5LuFv3kI1OUZxdlZZ1mE6MKpHrN23b29HKX5N9JSGHCfLNHI5Fo9bkJMqoKXcEa22OrpvScA7KXFvueX20u4poo5LYpcakMqUGJeCUJ5T3qLsW06HgiP52sLXA9h19uo2Vgjo05R8xvWrxBp3ptVXmCu3y2/a7/l/X/QJiaj1obv5G1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='ê¸°ì¡´ ë‹¬ë¡ì˜ ì¸í”„ë¼ êµ¬ì¡°' title='ê¸°ì¡´ ë‹¬ë¡ì˜ ì¸í”„ë¼ êµ¬ì¡°' src='/static/9344b830da3c9e25cda5144b40d78910/ca1dc/dallog_infra_before.png' srcset='/static/9344b830da3c9e25cda5144b40d78910/e7570/dallog_infra_before.png 170w,\n/static/9344b830da3c9e25cda5144b40d78910/f46e7/dallog_infra_before.png 340w,\n/static/9344b830da3c9e25cda5144b40d78910/ca1dc/dallog_infra_before.png 680w,\n/static/9344b830da3c9e25cda5144b40d78910/02d09/dallog_infra_before.png 1020w,\n/static/9344b830da3c9e25cda5144b40d78910/9d567/dallog_infra_before.png 1360w,\n/static/9344b830da3c9e25cda5144b40d78910/ac7a9/dallog_infra_before.png 1920w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>ê¸°ì¡´ ë‹¬ë¡ì˜ ì¸í”„ë¼ êµ¬ì¡°</figcaption>\n  </figure></p>\n<p>ê¸°ì¡´ ë‹¬ë¡ì˜ ì¸í”„ë¼ êµ¬ì¡°ë¥¼ ë‹¤ì‹œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. ë‹¬ë¡ì€ prod ì„œë²„ì™€ dev ì„œë²„ì— ëª¨ë‘ ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ì ìš©í–ˆëŠ”ë°ìš”, ìœ„ ì‚¬ì§„ì—ì„œ ë³´ì´ë‹¤ì‹œí”¼ dev ì„œë²„ì˜ ê²½ìš° í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ì— nginxì™€ springì„ í•¨ê»˜ ë„ì›Œë†¨ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ nginx ì„¤ì • íŒŒì¼ì—ì„œ <code class=\"language-text\">http://localhost:$service_port;</code> ë¡œ ì£¼ì†Œë¥¼ ì„¤ì •í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>\n<p>ë¶„ëª… ìŠ¤í¬ë¦½íŠ¸ë„ ë˜‘ê°™ì´ ì§°ê³  ì„¤ì •ë„ ì˜ í–ˆëŠ”ë° <code class=\"language-text\">service_port</code> ë³€ìˆ˜ ê°’ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•˜ëŠ” ì—ëŸ¬ë¥¼ ë§Œë‚¬ìŠµë‹ˆë‹¤ğŸ¥². í•œì°¸ì„ ì°¾ì•„ë³´ë‹ˆ <code class=\"language-text\">localhost</code>ë¥¼ ì‚¬ìš©í•˜ë©´ <code class=\"language-text\">resolver</code>ë¥¼ í†µí•´ ì£¼ì†Œë¥¼ <code class=\"language-text\">127.0.0.1</code> ë¡œ ë³€í™˜í•˜ëŠ”ë° ë’¤ì— <code class=\"language-text\">$service_port</code> ë³€ìˆ˜ê°€ ë¶™ì–´ ì£¼ì†Œë¥¼ ì°¾ì•„ ë³€í™˜í•˜ëŠ” ê³¼ì •ì— ë¬¸ì œê°€ ìƒê¸°ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.</p>\n<blockquote>\n<p>ì•½ê°„ì˜ ì°¸ê³  ìë£Œ â†’ <a href=\"https://trac.nginx.org/nginx/ticket/2335\">https://trac.nginx.org/nginx/ticket/2335</a></p>\n</blockquote>\n<p>ì •í™•í•œ ì›ì¸ê¹Œì§€ëŠ” íŒŒì•…í•˜ì§€ ëª»í–ˆìœ¼ë‚˜ <strong>í˜¹ì‹œ í•œ ì¸ìŠ¤í„´ìŠ¤ì— nginxì™€ springì„ í•¨ê»˜ ë‘ì—ˆë‹¤ë©´ ê¼­ ì£¼ì†Œë¥¼ <code class=\"language-text\">localhost</code> ê°€ ì•„ë‹Œ <code class=\"language-text\">127.0.0.1</code> ë¡œ ì„¤ì •í•©ì‹œë‹¤.</strong></p>\n<h3>5. ê¸°ì¡´ í¬íŠ¸ ì¢…ë£Œ</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"<span class=\"token variable\">${target_port}</span>\"</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"<span class=\"token variable\">${BLUE_PORT}</span>\"</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n    <span class=\"token function\">ssh</span> ubuntu@<span class=\"token variable\">${BACKEND_PROD_IP}</span> <span class=\"token string\">\"fuser -s -k <span class=\"token variable\">${GREEN_PORT}</span>/tcp\"</span>\n<span class=\"token keyword\">else</span>\n    <span class=\"token function\">ssh</span> ubuntu@<span class=\"token variable\">${BACKEND_PROD_IP}</span> <span class=\"token string\">\"fuser -s -k <span class=\"token variable\">${BLUE_PORT}</span>/tcp\"</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Kill the process on the opposite server. ğŸ”ª\"</span></code></pre></div>\n<p>ê¸°ì¡´ í¬íŠ¸ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.</p>\n<h1>ë¬´ì¤‘ë‹¨ ë°°í¬ ê²°ê³¼</h1>\n<p>í¬íŠ¸ ë³€ê²½ ë°©ì‹ì˜ ë¸”ë£¨ê·¸ë¦° ì „ëµì„ ì ìš©í•œ ë‹¬ë¡ì˜ CI/CD êµ¬ì¡°ëŠ” ì´ë ‡ìŠµë‹ˆë‹¤. ì¤‘ê°„ì— WSì— ë³€ê²½ëœ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ëŠ” ë¶€ë¶„ì€ ì‚¬ì§„ì—ì„œ ìƒëµë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/dbf24e47117afdb8b8942178078c1508/ac7a9/dallog_cicd_after.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACe0lEQVQoz02SW08TQRiGmxglcupp225beqLtbre73e2ZttiT0AKBcCgmnKSIMQZRNBovCd57Zbzwyv/6OLNG5OLL7MzsPPO97zuexUABn1JkMWDgVwz6tTKbtk6jWGYymTI9uaRUqHP18Y7ro0OcbIFsxkFPW8RiopI1AmETb9BwOZ5gpMSbt185Pf/A2fSG4+lnnJzF+doG+UyZlllj0mqgJqpYWgXj0y9SxRFaOEcqXkCJlgmGrf9Af8hke3fK1s5L1HiZTK5FToD6K33sYovlfJtadUg83SQvutKsIYYm1tUCAW+OcLwiOnwAnPdpRMXtiuhUyg9FbRS1hLpUIS3g8uc5r0Y42aST1Rj3CgzWB5SbDt1hi2zCxvcQqJs99iav3YOy26gASfCCXyccc7Ar65xf3LC2eULUr3H85YgX11M2Lvd49+2KJUV0qtqujy5QkpOpGkrIcIERIVtuyEqkGwTlz6L7OZ9O0Jdm9HxCr7tD/9kO2+MD8imTeb/Bo5mE24THq5jM6PvMxtoEQkVXqpT4ZDYjvqtEIgZq1OTq5pbd0Ta1ZA49ZYuky+SXK4QjRSr1TW7vvrOsdfD4AhqJ5imp1hlBAZSpF6yBG5Td2KJRsBlX61jVDbpWjdphHb3bwLugMReQvpms9vb58fM3hjjnpnxx8Z7J4StXckhITGQalOtjNHNASSS93hrgFRaoio59NKQ+6uBbyLMo7ApGLBc03johtbzy10NZclMC5UOVo0x/SXholIYUnTUy+Q5ZrU3THuBYPTFvuxKz+iqd7h67B5fumudfALK87o0lN10ZTijq3D8juSZLJqpEnfu5LOn546dpd/wDvrVMrq5/IVcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ì ìš©í•œ ë‹¬ë¡ì˜ CI/CD êµ¬ì¡°' title='ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ì ìš©í•œ ë‹¬ë¡ì˜ CI/CD êµ¬ì¡°' src='/static/dbf24e47117afdb8b8942178078c1508/ca1dc/dallog_cicd_after.png' srcset='/static/dbf24e47117afdb8b8942178078c1508/e7570/dallog_cicd_after.png 170w,\n/static/dbf24e47117afdb8b8942178078c1508/f46e7/dallog_cicd_after.png 340w,\n/static/dbf24e47117afdb8b8942178078c1508/ca1dc/dallog_cicd_after.png 680w,\n/static/dbf24e47117afdb8b8942178078c1508/02d09/dallog_cicd_after.png 1020w,\n/static/dbf24e47117afdb8b8942178078c1508/9d567/dallog_cicd_after.png 1360w,\n/static/dbf24e47117afdb8b8942178078c1508/ac7a9/dallog_cicd_after.png 1920w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ì ìš©í•œ ë‹¬ë¡ì˜ CI/CD êµ¬ì¡°</figcaption>\n  </figure></p>\n<p>ê·¸ë¦°ë¸”ë£¨ ì „ëµìœ¼ë¡œ ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ ì ìš©í•œ ê²°ê³¼ downtimeì´ <code class=\"language-text\">8ì´ˆ</code>ì—ì„œ <code class=\"language-text\">0.03ì´ˆ</code>ë¡œ í¬ê²Œ ì¤„ì—ˆìŠµë‹ˆë‹¤. nginx reloadí•˜ëŠ” ì´ ì§§ì€ ì‹œê°„ê¹Œì§€ë„ ì—†ì• ëŠ” ë°©ë²•ì´ ìˆëŠ”ì§€ ê¶ê¸ˆí•˜ë„¤ìš”. ì•„ì‹œëŠ” ë¶„ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.</p>\n<h3>References</h3>\n<p><a href=\"https://hudi.blog/zero-downtime-deployment-with-jenkins-and-nginx/\">Jenkinsì™€ Nginxë¡œ ìŠ¤í”„ë§ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¬´ì¤‘ë‹¨ ë°°í¬í•˜ê¸°</a></p>\n<p><a href=\"https://ecsimsw.tistory.com/940\">ë¬´ì¤‘ë‹¨ ë°°í¬ ì ìš©ê¸°</a></p>\n<p><a href=\"https://recordsoflife.tistory.com/325\">Spring Bootì—ì„œ ê¸°ë³¸ í¬íŠ¸ë¥¼ ë³€ê²½í•˜ëŠ” ë°©ë²•</a></p>\n<p><a href=\"https://www.samsungsds.com/kr/insights/1256264_4627.html\">ë¬´ì¤‘ë‹¨ ë°°í¬ ì•„í‚¤í…ì²˜(Zero Downtime Deployment)- ê¸€ë¡œë²Œ ì„œë¹„ìŠ¤ ìš´ì˜ì˜ í•„ìˆ˜ ìš”ì†Œ</a></p>","frontmatter":{"title":"ë‹¬ë¡ ë¬´ì¤‘ë‹¨ ë°°í¬ ë„ì…ê¸°","date":"October 26, 2022","update":"October 26, 2022","tags":["deploy","DevOps","íŒŒë‘"],"series":null},"fields":{"slug":"/zero-downtime-deployment/","readingTime":{"minutes":14.875}}},"seriesList":{"edges":[{"node":{"id":"a621dc7b-8590-5ec6-9b52-3d9e5182486d","fields":{"slug":"/appearance-background-of-jpa/"},"frontmatter":{"title":"JPA ë“±ì¥ë°°ê²½"}}},{"node":{"id":"9d2a87b6-2b9c-5b87-b790-3426d17c2d8e","fields":{"slug":"/intellij-final-keyword/"},"frontmatter":{"title":"IntelliJì—ì„œ ë©”ì†Œë“œ ì¶”ì¶œí•œ ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„°ì— final í‚¤ì›Œë“œ ìë™ ì¶”ê°€í•˜ê¸°"}}},{"node":{"id":"251e9767-1c92-5cf5-9cef-2c4a42c10df2","fields":{"slug":"/git-branch-strategy/"},"frontmatter":{"title":"ë‹¬ë¡íŒ€ì˜ git ë¸Œëœì¹˜ ì „ëµì„ ì†Œê°œí•©ë‹ˆë‹¤."}}},{"node":{"id":"5090cce3-0c1f-5376-badc-1d25e44c1bd9","fields":{"slug":"/infinite-scroll/"},"frontmatter":{"title":"Reactì—ì„œ ë¬´í•œ ìŠ¤í¬ë¡¤ êµ¬í˜„í•˜ê¸°"}}},{"node":{"id":"bcb53ba5-0286-5d10-96c2-fdcb88e2cc60","fields":{"slug":"/package-structure/"},"frontmatter":{"title":"ë‹¬ë¡ì— ì ì ˆí•œ íŒ¨í‚¤ì§€ êµ¬ì¡° ê³ ë¯¼í•˜ê¸°"}}},{"node":{"id":"a7fc89de-f37c-596e-a81d-3d4fe5a795b8","fields":{"slug":"/data-jpa-slice-page/"},"frontmatter":{"title":"Spring Data JPAì˜ Slice & Page"}}},{"node":{"id":"e1ba92ee-0cf0-50c8-80bd-5da5075df8d1","fields":{"slug":"/data-jpa-auditing/"},"frontmatter":{"title":"Spring Data JPAì˜ Auditing"}}},{"node":{"id":"3e036508-c916-504e-9e8d-89f69332471e","fields":{"slug":"/separated-interface/"},"frontmatter":{"title":"ì™¸ë¶€ì™€ ì˜ì¡´ì„± ë¶„ë¦¬í•˜ê¸°"}}},{"node":{"id":"cade544a-16ef-58a3-b97c-824986a8395f","fields":{"slug":"/apply-rest-docs/"},"frontmatter":{"title":"MockMvcë¥¼ ì‚¬ìš©í•œ Spring RestDocs"}}},{"node":{"id":"87649d54-d59e-58a6-afd5-8491eb4113a8","fields":{"slug":"/properties-to-object/"},"frontmatter":{"title":"properties ê°ì²´ë¡œ ë‹¤ë£¨ê¸°"}}},{"node":{"id":"eb380f6d-5a00-5a9e-a916-003fb292cc8a","fields":{"slug":"/test-fixture-constant/"},"frontmatter":{"title":"í…ŒìŠ¤íŠ¸ì—ì„œ Entity ê°ì²´ë¥¼ ìƒìˆ˜ë¡œ ë‘ë©´ ì•ˆ ë˜ëŠ” ì´ìœ "}}},{"node":{"id":"9734e30a-b430-5922-919d-f53808a56eb9","fields":{"slug":"/what_is_nginx/"},"frontmatter":{"title":"NGINX ë€?"}}},{"node":{"id":"9ebc6e21-2a76-5d42-be33-c2dae8c849b2","fields":{"slug":"/ssl_protocol/"},"frontmatter":{"title":"SSLì„ í†µí•œ HTTPSí†µì‹  ê³¼ì •"}}},{"node":{"id":"fa5ad595-1f81-5a20-a884-2da69adee3c5","fields":{"slug":"/integration-test-slice-test/"},"frontmatter":{"title":"í†µí•© í…ŒìŠ¤íŠ¸ì™€ ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸"}}},{"node":{"id":"d8c66823-bb05-5e83-a6a1-2fd9af450b6f","fields":{"slug":"/query-invalidation/"},"frontmatter":{"title":"React-Queryì—ì„œì˜ ë°ì´í„° ìµœì‹ í™” (Query Invalidation)"}}},{"node":{"id":"f5187517-342f-52a1-9092-d12c1a80d132","fields":{"slug":"/seperate-components/"},"frontmatter":{"title":"ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ ê¸°ì¤€"}}},{"node":{"id":"d6249c8b-bea6-5c91-8477-d3dd15ad9b39","fields":{"slug":"/test-isolation/"},"frontmatter":{"title":"í…ŒìŠ¤íŠ¸ ê²©ë¦¬"}}},{"node":{"id":"98e390ef-fb19-5d01-a3ef-d14bc0e65176","fields":{"slug":"/dallog-jacoco/"},"frontmatter":{"title":"ë‹¬ë¡ì˜ Jacoco ì ìš©ê¸° (feat. Gradle)"}}},{"node":{"id":"ab7073d6-575f-55b8-8b1d-fec1ea27916f","fields":{"slug":"/cannot-scroll-to-top-of-flex-element/"},"frontmatter":{"title":"ìŠ¤í¬ë¡¤ì„ í–ˆë”ë‹ˆ ìœ—ë¶€ë¶„ì´ ì•ˆ ë³´ì—¬ìš”!"}}},{"node":{"id":"33d19946-de0c-5b41-bfa0-d7c3fd80f10b","fields":{"slug":"/google-refresh-token/"},"frontmatter":{"title":"Googleì€ Refresh Tokenì„ ì‰½ê²Œ ë‚´ì£¼ì§€ ì•ŠëŠ”ë‹¤."}}},{"node":{"id":"8168857d-a82c-5608-bd40-cea4b917d17d","fields":{"slug":"/submodule/"},"frontmatter":{"title":"ë‹¬ë¡ ì„œë¸Œëª¨ë“ˆ ë„ì…ê¸°"}}},{"node":{"id":"836fc724-7e2f-5c7a-a42b-c0cc9163167a","fields":{"slug":"/dallog-flyway/"},"frontmatter":{"title":"ë‹¬ë¡ì˜ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•œ Flyway ì ìš©ê¸°"}}},{"node":{"id":"7a3bde6d-746b-56fd-8d91-0d8059ebf1f8","fields":{"slug":"/json-property-json-naming/"},"frontmatter":{"title":"@JsonProperty, @JsonNaming"}}},{"node":{"id":"50673f5c-f835-5982-b70c-b77e5a352a2c","fields":{"slug":"/servlet-life-cycle/"},"frontmatter":{"title":"ì„œë¸”ë¦¿ ìƒëª…ì£¼ê¸°ì™€ ì§ì ‘ë§Œë“  í†°ìº£ì„ í†µí•œ ì˜ë¬¸ì "}}},{"node":{"id":"61e7f4d1-7b3a-5968-bfe8-c3f6efb88748","fields":{"slug":"/preparing-for-performance-test/"},"frontmatter":{"title":"í†°ìº£ íŠœë‹ì„ ìœ„í•œ ë‹¬ë¡ì˜ ì„œë²„ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ê³¼ì •"}}},{"node":{"id":"9272061d-68c6-5f82-a961-0e2efe0fd6be","fields":{"slug":"/cyclic-dependency/"},"frontmatter":{"title":"cyclic dependency"}}},{"node":{"id":"6e779308-f266-58af-bfcc-e9fee6d39a98","fields":{"slug":"/multi-datasource-issue-with-osiv/"},"frontmatter":{"title":"ëŒ€ì²´ ì™œ DataSource ë¼ìš°íŒ…ì´ ì•ˆë˜ëŠ”ê±°ì•¼!? (feat. OSIV)"}}},{"node":{"id":"c7bea043-345c-5f78-ae53-796a83812961","fields":{"slug":"/react-query-useMutation-trouble-shooting/"},"frontmatter":{"title":"react-query useMutation onSuccess ì•ˆ ë˜ëŠ”ì¤„ ì•Œì•˜ë˜ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…"}}},{"node":{"id":"cf403487-1c48-5ca7-b5c2-ef0d8fefe3c4","fields":{"slug":"/jenkins-distributed-build-architecture/"},"frontmatter":{"title":"ì  í‚¨ìŠ¤ ë¶„ì‚° ë¹Œë“œ ì•„í‚¤í…ì²˜ êµ¬ì¶•"}}},{"node":{"id":"24c152c7-4e94-5b84-aaea-a5a9a8357693","fields":{"slug":"/zero-downtime-deployment/"},"frontmatter":{"title":"ë‹¬ë¡ ë¬´ì¤‘ë‹¨ ë°°í¬ ë„ì…ê¸°"}}},{"node":{"id":"623f9105-974d-51b9-84c7-f6298a8d1c19","fields":{"slug":"/get-valid-accessToken/"},"frontmatter":{"title":"refreshTokenìœ¼ë¡œ accessToken ì¬ë°œê¸‰í•˜ê¸°"}}},{"node":{"id":"d34299f0-eb49-5aef-a38f-963200d5fd6d","fields":{"slug":"/test-readability/"},"frontmatter":{"title":"ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸ ì½”ë“œ ê°€ë…ì„±ì„ ê°œì„ í•  ìˆ˜ ìˆì„ê¹Œ??"}}},{"node":{"id":"fe27c1ec-d040-5cf4-934a-a5eeb2131dfb","fields":{"slug":"/troubleshooting-of-category-role-concurrency-issue/"},"frontmatter":{"title":"JPAì˜ ë‚™ê´€ì  ë½ì„ ì‚¬ìš©í•œ ë™ì‹œì„± ì´ìŠˆ í•´ê²°"}}}]},"previous":{"fields":{"slug":"/jenkins-distributed-build-architecture/"},"frontmatter":{"title":"ì  í‚¨ìŠ¤ ë¶„ì‚° ë¹Œë“œ ì•„í‚¤í…ì²˜ êµ¬ì¶•"}},"next":{"fields":{"slug":"/get-valid-accessToken/"},"frontmatter":{"title":"refreshTokenìœ¼ë¡œ accessToken ì¬ë°œê¸‰í•˜ê¸°"}}},"pageContext":{"id":"24c152c7-4e94-5b84-aaea-a5a9a8357693","series":null,"previousPostId":"cf403487-1c48-5ca7-b5c2-ef0d8fefe3c4","nextPostId":"623f9105-974d-51b9-84c7-f6298a8d1c19"}},"staticQueryHashes":[]}